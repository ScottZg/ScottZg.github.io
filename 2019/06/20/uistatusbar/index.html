<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="default" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>设置UIstatusBarStyle的正确姿势 | 我不是掌柜</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + 'bedfe77e6747a86ea485d0b5e0839981';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
  </script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">设置UIstatusBarStyle的正确姿势</h1><a id="logo" href="/.">我不是掌柜</a><p class="description">一个iOS开发工程师</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">设置UIstatusBarStyle的正确姿势</h1><div class="post-meta">Jun 20, 2019</div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Inhalte</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一-前言"><span class="toc-number">1.</span> <span class="toc-text">一. 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二-正文"><span class="toc-number">2.</span> <span class="toc-text">二. 正文</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#设置APP启动时状态栏状态"><span class="toc-number">2.1.</span> <span class="toc-text">设置APP启动时状态栏状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#设置状态栏样式"><span class="toc-number">2.2.</span> <span class="toc-text">设置状态栏样式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#第一种方式：通过setStatusBarStyle设置"><span class="toc-number">2.2.1.</span> <span class="toc-text">第一种方式：通过setStatusBarStyle设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第二种方式：通过重写preferredStatusBarStyle设置"><span class="toc-number">2.2.2.</span> <span class="toc-text">第二种方式：通过重写preferredStatusBarStyle设置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注意点"><span class="toc-number">3.</span> <span class="toc-text">注意点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="post-content"><h2 id="一-前言"><a href="#一-前言" class="headerlink" title="一. 前言"></a>一. 前言</h2><p>iOS开发过程中经常会修改导航栏的背景色（或者设置透明渐变），为了适配背景色，需要对状态栏的颜色进行变更，本文主要介绍对状态栏颜色的变更。</p>
<h2 id="二-正文"><a href="#二-正文" class="headerlink" title="二. 正文"></a>二. 正文</h2><p>状态栏颜色变更可以理解为其样式的变更，通过苹果API可知状态栏有以下几种样式：   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, UIStatusBarStyle) &#123;</span><br><span class="line">    UIStatusBarStyleDefault                                     = 0, // Dark content, for use on light backgrounds</span><br><span class="line">    UIStatusBarStyleLightContent     NS_ENUM_AVAILABLE_IOS(7_0) = 1, // Light content, for use on dark backgrounds</span><br><span class="line">    </span><br><span class="line">    UIStatusBarStyleBlackTranslucent NS_ENUM_DEPRECATED_IOS(2_0, 7_0, &quot;Use UIStatusBarStyleLightContent&quot;) = 1,</span><br><span class="line">    UIStatusBarStyleBlackOpaque      NS_ENUM_DEPRECATED_IOS(2_0, 7_0, &quot;Use UIStatusBarStyleLightContent&quot;) = 2,</span><br><span class="line">&#125; __TVOS_PROHIBITED;</span><br></pre></td></tr></table></figure>
<p>后两种已经弃用，主要是下面两种：  </p>
<ol>
<li>UIStatusBarStyleDefault：默认的黑色字体内容，主要用与浅色背景。</li>
<li>UIStatusBarStyleLightContent：默认的浅色内容(白色)，主要用于深色背景。   <h3 id="设置APP启动时状态栏状态"><a href="#设置APP启动时状态栏状态" class="headerlink" title="设置APP启动时状态栏状态"></a>设置APP启动时状态栏状态</h3>在info.plist文件中，开发者可以设置UIStatusBarStyle和UIStatusBarHidden选项，该选项说明如下：<br><img src="https://raw.githubusercontent.com/ScottZg/MarkDownResource/master/UIStatusBarStyle/Infoplistshow.png" alt="info.plist"></li>
</ol>
<p>默认情况下：   </p>
<ol>
<li>UIStatusBarStyle值为：UIStatusBarStyleDefault</li>
<li>UIStatubBarHidden值为：NO</li>
</ol>
<p>开发者可以在Info.plist中进行设置两个值来控制在启动页展示的时候状态栏是否隐藏以及其Style。接下来需要关注另外一个key：UIViewControllerBasedStatusBarAppearance。该key的作用是指示状态栏的外观是否基于当前控制器的样式。该值默认为YES，如果设置为NO，则在Info.plist中设置的UIStatusBarStyle和UIStatubBarHidden就会状态保持。也就是说如果为NO，并且设置UIStatubBarHidden为NO，那APP启动之后是不展示状态栏的。如果UIViewControllerBasedStatusBarAppearance设置为YES或者不设置（默认为YES），在Info.plist中设置只会影响APP启动时状态栏的样式，不会影响启动之后进入首页的样式。</p>
<blockquote>
<p><code>UIViewControllerBasedStatusBarAppearance</code> (Boolean - iOS) Specifies whether the status bar appearance is based on the style preferred by the view controller that is currently under the status bar. When this key is not present or its value is set to <code>YES</code>, the view controller determines the status bar style. When the key is set to <code>NO</code>, view controllers (or the app) must each set the status bar style explicitly using the <code>UIApplication</code> object.</p>
<p>This key is supported in iOS 7.0 and later.状态栏UIStatusBarStyle设置</p>
</blockquote>
<h3 id="设置状态栏样式"><a href="#设置状态栏样式" class="headerlink" title="设置状态栏样式"></a>设置状态栏样式</h3><p>在程序进入前台之后，开发者可以通过下面两种方式更改状态栏的状态：</p>
<h4 id="第一种方式：通过setStatusBarStyle设置"><a href="#第一种方式：通过setStatusBarStyle设置" class="headerlink" title="第一种方式：通过setStatusBarStyle设置"></a>第一种方式：通过setStatusBarStyle设置</h4><p>直接使用UIApplication提供的方法进行设置：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleLightContent];</span><br></pre></td></tr></table></figure>
<p>运行之后发现状态栏内容颜色依然为黑色，为什么没有生效呢？原来是需要在info.plist中设置UIViewControllerBasedStatusBarAppearance为NO。设置为NO之后，该方式才能设置成功。该方式有两个问题：  </p>
<ol>
<li>该设置方式在iOS9之后就被弃用了，苹果建议使用preferredStatusBarStyle进行设置。当然如果你的APP想要支持iOS9之前的版本，则需要对版本进行判断。 </li>
<li>如果只想为某个页面设置UIStatusBarStyleLightContent，入口页面保持不变，则需要对状态进行还原。即在特定VC中的viewWillAppear中设置为UIStatusBarStyleLightContent，在viewWillDisappear中设置为UIStatusBarStyleDefault。否则将会影响其他页面状态栏样式展示。 </li>
</ol>
<h4 id="第二种方式：通过重写preferredStatusBarStyle设置"><a href="#第二种方式：通过重写preferredStatusBarStyle设置" class="headerlink" title="第二种方式：通过重写preferredStatusBarStyle设置"></a>第二种方式：通过重写preferredStatusBarStyle设置</h4><p>通过这种方式设置状态时，需要将UIViewControllerBasedStatusBarAppearance设置为YES(或者不设置，默认为YES)。然后在VC中重写preferredStatusBarStyle：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (UIStatusBarStyle)preferredStatusBarStyle &#123;</span><br><span class="line">    return UIStatusBarStyleLightContent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序发现不生效。看下该方法的说明：  </p>
<blockquote>
<p>You can override the preferred status bar style for a view controller by implementing the <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621433-childviewcontrollerforstatusbars?language=objc" target="_blank" rel="noopener"><code>childViewControllerForStatusBarStyle</code></a> method.</p>
<p>If the return value from this method changes, call the <a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621354-setneedsstatusbarappearanceupdat?language=objc" target="_blank" rel="noopener"><code>setNeedsStatusBarAppearanceUpdate</code></a> method.</p>
</blockquote>
<p>看说明是需要实现childViewControllerForStatusBarStyle方法。看到childViewController，一般会联想到navigationController和tabBarController，他们都有自己的childViewController。因为测试的Demo是有navigation导航的，有没有可能是因为需要重写一下navigationController的看说明是需要实现childViewControllerForStatusBarStyle方法呢？因此做了如下尝试：将ViewController直接设置为window的rootVC，再次运行，发现生效了。因此可能是由navigationController导致的问题。<br>接下来实现NavigationController的子类，然后在子类中实现如下方法：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (UIViewController *)childViewControllerForStatusBarStyle &#123;</span><br><span class="line">    return self.topViewController;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后再次运行程序，发现这次在ViewController中设置的样式生效了。经过测试发现：如果在navigationController中不实现childViewControllerForStatusBarStyle，则会调用navigationController的preferredStatusBarStyle。如果实现了该方法，该方法会返回导航栈最顶层的VC。  </p>
<blockquote>
<p>If your container view controller derives its status bar style from one of its child view controllers, implement this method and return that child view controller. If you return <code>nil</code> or do not override this method, the status bar style for <code>self</code> is used. If the return value from this method changes, call the <code>setNeedsStatusBarAppearanceUpdate</code> method.</p>
</blockquote>
<p>从childViewControllerForStatusBarStyle文档可知，如果开发者想要通过navigationController的子VC来重写导航栈，那就需要通过该方法将特定的VC返回。这里总是返回最顶层的VC。<br>因此如果发现带导航栈APP的preferredStatusBarStyle不生效，可以对childViewControllerForStatusBarStyle进行重写。<br>状态栏的隐藏方法prefersStatusBarHidden和preferredStatusBarStyle类似，也是需要实现childViewControllerForStatusBarHidden。这里就不再赘述。<br>这里需要注意的是：当在VC中对状态栏的状态进行重设（prefersStatusBarHidden 或者preferredStatusBarStyle返回值有所变更）每次对状态栏状态进行变更，都需要调用setNeedsStatusBarAppearanceUpdate方法，该方法会告诉系统，VC的状态栏状态发生改变，进而会重新调用prefersStatusBarHidden或者preferredStatusBarStyle。   </p>
<h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h2><ol>
<li>每次状态栏状态之后，需要调用一下setNeedsStatusBarAppearanceUpdate方法。</li>
<li>如果是UITabBarController，也需要实现childViewControllerForStatusBarStyle(或者childViewControllerForStatusBarHidden)来指定特定VC（TabBarController中重写childViewControllerForStatusBar <em> </em> 返回tabBarController的selectedViewController ）。</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="https://developer.apple.com/documentation/bundleresources/information_property_list/uiviewcontrollerbasedstatusbarappearance?language=objc" target="_blank" rel="noopener">UIViewControllerBasedStatusBarAppearance</a></li>
<li><a href="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/iPhoneOSKeys.html#//apple_ref/doc/uid/TP40009252-SW10" target="_blank" rel="noopener">Information Property List Key Reference</a></li>
<li><a href="https://stackoverflow.com/questions/45372550/preferredstatusbarstyle-is-not-working" target="_blank" rel="noopener">https://stackoverflow.com/questions/45372550/preferredstatusbarstyle-is-not-working</a></li>
</ol>
</div><div class="tags"><a href="/tags/UIStatusBar/">UIStatusBar</a><a href="/tags/iOS/">iOS</a></div><div class="post-nav"><a class="next" href="/2019/03/15/3d-touch-guide/">你想知道的3D Touch开发全在这里了</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://supermokey.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Xcode/" style="font-size: 15px;">Xcode</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/编译型语言/" style="font-size: 15px;">编译型语言</a> <a href="/tags/字节码/" style="font-size: 15px;">字节码</a> <a href="/tags/Ruby/" style="font-size: 15px;">Ruby</a> <a href="/tags/UIStatusBar/" style="font-size: 15px;">UIStatusBar</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/解释型语言/" style="font-size: 15px;">解释型语言</a> <a href="/tags/LinkMapFile/" style="font-size: 15px;">LinkMapFile</a> <a href="/tags/Accessibility/" style="font-size: 15px;">Accessibility</a> <a href="/tags/LivePhoto/" style="font-size: 15px;">LivePhoto</a> <a href="/tags/HEVC/" style="font-size: 15px;">HEVC</a> <a href="/tags/HEIF/" style="font-size: 15px;">HEIF</a> <a href="/tags/WebDriverAgent/" style="font-size: 15px;">WebDriverAgent</a> <a href="/tags/3D-Touch/" style="font-size: 15px;">3D Touch</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/06/20/uistatusbar/">设置UIstatusBarStyle的正确姿势</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/15/3d-touch-guide/">你想知道的3D Touch开发全在这里了</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/18/git-branch-standard/">Git分支管理规范</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/16/ruby/">Ruby入坑指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/21/interpreted-vs-compiled/">解释型语言、编译型语言</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/20/link-map-file-known/">对Link Map File的初步认识</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/28/create-own-gem/">RubyGems系列之创建自己的gem</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/28/rubygems-know/">RubyGems系列之RubyGems初识</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/21/xcode10-feature/">关于Xcode10的那些事</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/05/wda/">WebDriverAgent入门篇-安装和使用</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 超链接</i></div><ul></ul><a href="http://cnblogs.com/zhanggui" title="我的博客园" target="_blank">我的博客园</a><ul></ul><a href="http://www.zhaoyafei.cn" title="赵亚飞的博客" target="_blank">赵亚飞的博客</a><ul></ul><a href="http://www.maoyan.com" title="猫眼电影" target="_blank">猫眼电影</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">我不是掌柜.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>